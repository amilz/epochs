use anchor_lang::prelude::*;
use anchor_spl::{
    associated_token::AssociatedToken,
    token::{Token, TokenAccount, Mint, MintTo, mint_to},
    metadata::Metadata,
};
use mpl_token_metadata::{
    accounts::{Metadata as MetadataAccount, MasterEdition},
    instructions::{
        CreateMetadataAccountV3Builder,
        CreateMasterEditionV3Builder,
        SetAndVerifySizedCollectionItemBuilder
    },
    types::DataV2,
};
use anchor_lang::solana_program::program::invoke_signed;
use mpl_inscription::{
    ID as INSCRIPTION_ID,
    instructions::{InitializeFromMintBuilder, WriteDataBuilder},
    accounts::MintInscription,
};

use crate::constants::COLLECTION_SEED;

#[derive(Accounts)]
pub struct MintNftInCollection<'info> {
    #[account(mut)]
    pub user: Signer<'info>,

    #[account(
        mut,
        seeds = [COLLECTION_SEED.as_bytes()],
        bump,
    )]
    pub collection_mint: Account<'info, Mint>,

    /// CHECK: in program
    #[account(
        mut,
        address=MetadataAccount::find_pda(&collection_mint.key()).0
    )]
    pub collection_metadata_account: UncheckedAccount<'info>,

    /// CHECK: in program
    #[account(
        mut,
        address=MasterEdition::find_pda(&collection_mint.key()).0
    )]
    pub collection_master_edition: UncheckedAccount<'info>,

    #[account(
        init,
        payer = user,
        mint::decimals = 0,
        mint::authority = collection_mint,
        mint::freeze_authority = collection_mint
    )]
    pub nft_mint: Account<'info, Mint>,

    /// CHECK: in program
    #[account(
        mut,
        address=MetadataAccount::find_pda(&nft_mint.key()).0
    )]
    pub metadata_account: UncheckedAccount<'info>,

    /// CHECK: in program
    #[account(
        mut,
        address=MasterEdition::find_pda(&nft_mint.key()).0
    )]
    pub master_edition: UncheckedAccount<'info>,

    #[account(
        init,
        payer = user,
        associated_token::mint = nft_mint,
        associated_token::authority = user
    )]
    pub token_account: Account<'info, TokenAccount>,

    pub system_program: Program<'info, System>,
    pub token_program: Program<'info, Token>,
    pub associated_token_program: Program<'info, AssociatedToken>,
    pub token_metadata_program: Program<'info, Metadata>,
    pub rent: Sysvar<'info, Rent>,

    // *** INSCRIPTION ***

    /// CHECK: Address constraint
    #[account(address = INSCRIPTION_ID)]
    pub inscription_program: UncheckedAccount<'info>,
    /// CHECK: in program
    #[account(
        mut,
        address = MintInscription::find_pda(&nft_mint.key()).0,
    )]
    mint_inscription_account: UncheckedAccount<'info>,
    /// CHECK: in program
    #[account(
        mut,
        //address = InscriptionMetadata::find_pda(&nft_mint.key()).0,
    )]
    inscription_metadata_account: UncheckedAccount<'info>,
    /// CHECK: in program
    #[account(
        mut,
        //TODO possibly include the shard number as instruction data
        //address = InscriptionShard::find_pda(15).0,
    )]
    inscription_shard_account: UncheckedAccount<'info>,
}

pub fn handler(ctx: Context<MintNftInCollection>) -> Result<()> {
    const NAME: &str = "The Epochs";
    const SYMBOL: &str = "EPOCH";
    const URI: &str = "https://arweave.net/PkmMMr2GNK3eraWcat-pl7BwGGUQN5QLEyzDtIjbYWI";

    // Collection Mint PDA for signing
    let bump: &[u8;1] = &[ctx.bumps.collection_mint];
    let seeds: &[&[u8]] = &[COLLECTION_SEED.as_bytes(), bump];
    let signer_seeds: &[&[&[u8]]] = &[&seeds[..]];

    // mint collection nft
    mint_to(
        CpiContext::new_with_signer(
            ctx.accounts.token_program.to_account_info(),
            MintTo {
                mint: ctx.accounts.nft_mint.to_account_info(),
                to: ctx.accounts.token_account.to_account_info(),
                authority: ctx.accounts.collection_mint.to_account_info(),
            },
            signer_seeds,
        ),
        1,
    )?;

    let nft_data: DataV2 = DataV2 {
        name: NAME.to_string(),
        symbol: SYMBOL.to_string(),
        uri: URI.to_string(),
        seller_fee_basis_points: 0,
        // TODO: Add creators
        creators: None,
        collection: None,
        uses: None,
    };

    let create_metadata_ix = CreateMetadataAccountV3Builder::new()
        .metadata(ctx.accounts.metadata_account.to_account_info().key())
        .mint(ctx.accounts.nft_mint.to_account_info().key())
        .mint_authority(ctx.accounts.collection_mint.to_account_info().key())
        .payer(ctx.accounts.user.to_account_info().key())
        .update_authority(ctx.accounts.collection_mint.to_account_info().key(), true)
        .system_program(ctx.accounts.system_program.to_account_info().key())
        .rent(Some(ctx.accounts.rent.to_account_info().key()))
        .is_mutable(false)
        .data(nft_data)
        .instruction(); 

    invoke_signed(
        &create_metadata_ix,
        &[
            ctx.accounts.metadata_account.to_account_info(),
            ctx.accounts.nft_mint.to_account_info(),
            ctx.accounts.collection_mint.to_account_info(),
            ctx.accounts.user.to_account_info(),
            ctx.accounts.system_program.to_account_info(),
            ctx.accounts.rent.to_account_info(),
        ],
        signer_seeds
    )?;

    let create_master_edition_ix = CreateMasterEditionV3Builder::new()
        .metadata(ctx.accounts.metadata_account.to_account_info().key())
        .mint(ctx.accounts.nft_mint.to_account_info().key())
        .edition(ctx.accounts.master_edition.to_account_info().key())
        .mint_authority(ctx.accounts.collection_mint.to_account_info().key())
        .update_authority(ctx.accounts.collection_mint.to_account_info().key())
        .payer(ctx.accounts.user.to_account_info().key())
        .token_program(ctx.accounts.token_program.to_account_info().key())
        .system_program(ctx.accounts.system_program.to_account_info().key())
        .rent(Some(ctx.accounts.rent.to_account_info().key()))
        .max_supply(0)
        .instruction();

    invoke_signed(
        &create_master_edition_ix,
        &[
            ctx.accounts.metadata_account.to_account_info(),
            ctx.accounts.nft_mint.to_account_info(),
            ctx.accounts.master_edition.to_account_info(),
            ctx.accounts.collection_mint.to_account_info(),
            ctx.accounts.user.to_account_info(),
            ctx.accounts.token_program.to_account_info(),
            ctx.accounts.system_program.to_account_info(),
            ctx.accounts.rent.to_account_info(),
        ],
        signer_seeds
    )?;
    
    let verify_collection_ix = SetAndVerifySizedCollectionItemBuilder::new()
        .metadata(ctx.accounts.metadata_account.to_account_info().key())
        .collection_authority(ctx.accounts.collection_mint.to_account_info().key())
        .payer(ctx.accounts.user.to_account_info().key())
        .update_authority(ctx.accounts.collection_mint.to_account_info().key())
        .collection_mint(ctx.accounts.collection_mint.to_account_info().key())
        .collection(ctx.accounts.collection_metadata_account.to_account_info().key())
        .collection_master_edition_account(ctx.accounts.collection_master_edition.to_account_info().key())
        .instruction();

    invoke_signed(
        &verify_collection_ix,
        &[
            ctx.accounts.metadata_account.to_account_info(),
            ctx.accounts.collection_mint.to_account_info(),
            ctx.accounts.user.to_account_info(),
            ctx.accounts.collection_metadata_account.to_account_info(),
            ctx.accounts.collection_master_edition.to_account_info(),
        ],
        signer_seeds
    )?;


    let inscribe_nft = InitializeFromMintBuilder::new()
        .mint_account(ctx.accounts.nft_mint.to_account_info().key())
        .system_program(ctx.accounts.system_program.to_account_info().key())
        .payer(ctx.accounts.user.to_account_info().key())
        .authority(Some(ctx.accounts.collection_mint.to_account_info().key()))
        .token_metadata_account(ctx.accounts.metadata_account.to_account_info().key())
        .mint_inscription_account(ctx.accounts.mint_inscription_account.to_account_info().key())
        .inscription_metadata_account(ctx.accounts.inscription_metadata_account.to_account_info().key())
        .inscription_shard_account(ctx.accounts.inscription_shard_account.to_account_info().key())
        .instruction();

    invoke_signed(
        &inscribe_nft,
        &[
            ctx.accounts.nft_mint.to_account_info(),
            ctx.accounts.user.to_account_info(),
            ctx.accounts.collection_mint.to_account_info(),
            ctx.accounts.metadata_account.to_account_info(),
            ctx.accounts.mint_inscription_account.to_account_info(),
            ctx.accounts.inscription_metadata_account.to_account_info(),
            ctx.accounts.inscription_shard_account.to_account_info(),
            ctx.accounts.system_program.to_account_info(),
        ],
        signer_seeds
    )?;

    let write_data = WriteDataBuilder::new()
        .inscription_account(ctx.accounts.mint_inscription_account.to_account_info().key())
        .inscription_metadata_account(ctx.accounts.inscription_metadata_account.to_account_info().key())
        .payer(ctx.accounts.user.to_account_info().key())
        .authority(Some(ctx.accounts.collection_mint.to_account_info().key()))
        .value(
            vec![
    66,
    77,
    54,
    12,
    0,
    0,
    0,
    0,
    0,
    0,
    54,
    0,
    0,
    0,
    40,
    0,
    0,
    0,
    32,
    0,
    0,
    0,
    32,
    0,
    0,
    0,
    1,
    0,
    24,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    246,
    4,
    96,
    195,
    45,
    92,
    183,
    16,
    172,
    50,
    50,
    51,
    68,
    68,
    68,
    50,
    50,
    51,
    68,
    68,
    68,
    68,
    68,
    68,
    241,
    241,
    241,
    0,
    0,
    208,
    241,
    241,
    241,
    68,
    68,
    68,
    50,
    50,
    51,
    68,
    68,
    68,
    50,
    50,
    51,
    72,
    185,
    172,
    253,
    236,
    155,
    219,
    217,
    186,
    221,
    204,
    230,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    162,
    111,
    199,
    21,
    15,
    32,
    97,
    253,
    82,
    50,
    50,
    51,
    68,
    68,
    68,
    50,
    50,
    51,
    68,
    68,
    68,
    68,
    68,
    68,
    241,
    241,
    241,
    0,
    0,
    208,
    241,
    241,
    241,
    68,
    68,
    68,
    50,
    50,
    51,
    68,
    68,
    68,
    50,
    50,
    51,
    236,
    230,
    238,
    16,
    27,
    36,
    36,
    120,
    68,
    167,
    73,
    217,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    192,
    178,
    139,
    144,
    210,
    117,
    88,
    111,
    243,
    50,
    50,
    51,
    68,
    68,
    68,
    68,
    68,
    68,
    68,
    68,
    68,
    50,
    50,
    51,
    241,
    241,
    241,
    0,
    0,
    208,
    241,
    241,
    241,
    50,
    50,
    51,
    68,
    68,
    68,
    68,
    68,
    68,
    50,
    50,
    51,
    128,
    87,
    84,
    239,
    135,
    103,
    140,
    230,
    89,
    216,
    15,
    90,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    212,
    148,
    28,
    114,
    230,
    118,
    98,
    86,
    169,
    50,
    50,
    51,
    68,
    68,
    68,
    68,
    68,
    68,
    50,
    50,
    51,
    68,
    68,
    68,
    241,
    241,
    241,
    0,
    0,
    208,
    241,
    241,
    241,
    68,
    68,
    68,
    50,
    50,
    51,
    68,
    68,
    68,
    50,
    50,
    51,
    227,
    217,
    146,
    158,
    244,
    31,
    220,
    106,
    143,
    85,
    210,
    55,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    98,
    104,
    161,
    93,
    19,
    161,
    186,
    101,
    147,
    186,
    232,
    77,
    50,
    50,
    51,
    50,
    50,
    51,
    68,
    68,
    68,
    68,
    68,
    68,
    241,
    241,
    241,
    0,
    0,
    172,
    241,
    241,
    241,
    68,
    68,
    68,
    68,
    68,
    68,
    50,
    50,
    51,
    82,
    240,
    247,
    40,
    85,
    162,
    114,
    108,
    197,
    182,
    198,
    60,
    53,
    26,
    126,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    183,
    20,
    86,
    11,
    77,
    209,
    164,
    176,
    53,
    234,
    40,
    235,
    14,
    220,
    229,
    50,
    50,
    51,
    50,
    50,
    51,
    13,
    164,
    98,
    239,
    180,
    26,
    37,
    39,
    152,
    154,
    113,
    230,
    50,
    50,
    51,
    50,
    50,
    51,
    246,
    154,
    146,
    7,
    102,
    131,
    5,
    30,
    220,
    250,
    234,
    192,
    239,
    183,
    54,
    152,
    178,
    210,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    128,
    249,
    161,
    159,
    198,
    221,
    25,
    185,
    181,
    113,
    148,
    129,
    237,
    97,
    30,
    203,
    15,
    208,
    3,
    140,
    213,
    97,
    2,
    249,
    166,
    119,
    13,
    103,
    239,
    46,
    83,
    206,
    138,
    70,
    25,
    115,
    115,
    44,
    185,
    182,
    213,
    194,
    14,
    141,
    84,
    162,
    75,
    170,
    186,
    120,
    92,
    95,
    151,
    55,
    220,
    90,
    180,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    172,
    149,
    187,
    255,
    67,
    175,
    10,
    203,
    100,
    45,
    225,
    18,
    122,
    203,
    233,
    126,
    169,
    82,
    240,
    210,
    234,
    182,
    78,
    17,
    142,
    200,
    41,
    179,
    241,
    206,
    203,
    64,
    135,
    99,
    90,
    80,
    186,
    225,
    31,
    223,
    17,
    132,
    0,
    65,
    240,
    168,
    231,
    53,
    187,
    141,
    129,
    233,
    230,
    199,
    6,
    203,
    117,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    83,
    229,
    201,
    197,
    93,
    63,
    246,
    52,
    190,
    218,
    67,
    247,
    38,
    151,
    225,
    199,
    243,
    211,
    215,
    48,
    84,
    208,
    38,
    13,
    3,
    84,
    202,
    13,
    171,
    214,
    243,
    167,
    255,
    156,
    79,
    125,
    174,
    105,
    255,
    144,
    67,
    93,
    242,
    118,
    194,
    195,
    69,
    167,
    204,
    57,
    127,
    44,
    37,
    243,
    196,
    239,
    31,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    132,
    124,
    38,
    125,
    19,
    104,
    150,
    223,
    173,
    5,
    132,
    41,
    242,
    130,
    125,
    108,
    162,
    75,
    165,
    108,
    140,
    81,
    111,
    197,
    159,
    153,
    79,
    151,
    183,
    252,
    237,
    253,
    36,
    152,
    31,
    103,
    228,
    168,
    221,
    219,
    158,
    145,
    4,
    156,
    163,
    225,
    223,
    227,
    248,
    241,
    147,
    161,
    54,
    32,
    233,
    253,
    245,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    31,
    222,
    74,
    33,
    200,
    212,
    57,
    57,
    124,
    20,
    13,
    22,
    30,
    103,
    181,
    239,
    3,
    228,
    71,
    149,
    252,
    14,
    146,
    129,
    227,
    109,
    61,
    132,
    36,
    149,
    17,
    200,
    185,
    117,
    143,
    158,
    58,
    195,
    97,
    130,
    123,
    112,
    149,
    111,
    195,
    252,
    39,
    250,
    65,
    59,
    21,
    11,
    213,
    24,
    225,
    58,
    149,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    102,
    234,
    106,
    79,
    104,
    93,
    13,
    189,
    121,
    144,
    239,
    178,
    222,
    252,
    181,
    131,
    28,
    158,
    68,
    152,
    84,
    3,
    238,
    77,
    116,
    150,
    47,
    120,
    206,
    198,
    233,
    37,
    128,
    229,
    230,
    204,
    114,
    7,
    189,
    53,
    36,
    8,
    190,
    92,
    126,
    184,
    3,
    245,
    40,
    233,
    233,
    37,
    220,
    244,
    228,
    85,
    98,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    224,
    120,
    161,
    236,
    143,
    250,
    236,
    54,
    170,
    251,
    243,
    17,
    74,
    244,
    23,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    8,
    65,
    96,
    227,
    36,
    180,
    98,
    133,
    249,
    175,
    191,
    43,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    169,
    171,
    107,
    191,
    66,
    111,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    92,
    103,
    39,
    80,
    103,
    52,
    17,
    241,
    170,
    133,
    19,
    164,
    20,
    20,
    20,
    215,
    217,
    187,
    245,
    247,
    217,
    245,
    247,
    217,
    245,
    247,
    217,
    20,
    20,
    20,
    28,
    78,
    241,
    247,
    10,
    14,
    20,
    20,
    20,
    215,
    217,
    187,
    245,
    247,
    217,
    245,
    247,
    217,
    245,
    247,
    217,
    20,
    20,
    20,
    251,
    88,
    116,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    139,
    108,
    183,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    245,
    247,
    217,
    245,
    247,
    217,
    245,
    247,
    217,
    123,
    59,
    194,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    245,
    247,
    217,
    245,
    247,
    217,
    245,
    247,
    217,
    26,
    152,
    52,
    20,
    20,
    20,
    90,
    89,
    111,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    219,
    30,
    130,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    20,
    20,
    20,
    245,
    247,
    217,
    245,
    247,
    217,
    111,
    111,
    111,
    111,
    111,
    111,
    20,
    20,
    20,
    111,
    111,
    111,
    111,
    111,
    111,
    20,
    20,
    20,
    245,
    247,
    217,
    245,
    247,
    217,
    111,
    111,
    111,
    111,
    111,
    111,
    20,
    20,
    20,
    242,
    253,
    75,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    55,
    32,
    124,
    111,
    111,
    111,
    144,
    144,
    145,
    111,
    111,
    111,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    144,
    144,
    145,
    111,
    111,
    111,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    20,
    102,
    193,
    72,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    173,
    61,
    146,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    18,
    164,
    116,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    181,
    34,
    197,
    219,
    32,
    163,
    111,
    111,
    111,
    144,
    144,
    145,
    144,
    144,
    145,
    144,
    144,
    145,
    144,
    144,
    145,
    144,
    144,
    145,
    144,
    144,
    145,
    144,
    144,
    145,
    144,
    144,
    145,
    144,
    144,
    145,
    144,
    144,
    145,
    144,
    144,
    145,
    144,
    144,
    145,
    144,
    144,
    145,
    111,
    111,
    111,
    91,
    233,
    82,
    204,
    41,
    18,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    230,
    108,
    28,
    243,
    138,
    129,
    111,
    111,
    111,
    144,
    144,
    145,
    144,
    144,
    145,
    144,
    144,
    145,
    144,
    144,
    145,
    144,
    144,
    145,
    144,
    144,
    145,
    144,
    144,
    145,
    144,
    144,
    145,
    144,
    144,
    145,
    144,
    144,
    145,
    144,
    144,
    145,
    144,
    144,
    145,
    144,
    144,
    145,
    111,
    111,
    111,
    168,
    84,
    168,
    211,
    250,
    1,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    130,
    244,
    25,
    79,
    193,
    22,
    21,
    237,
    159,
    111,
    111,
    111,
    111,
    111,
    111,
    144,
    144,
    145,
    144,
    144,
    145,
    144,
    144,
    145,
    144,
    144,
    145,
    144,
    144,
    145,
    144,
    144,
    145,
    144,
    144,
    145,
    144,
    144,
    145,
    144,
    144,
    145,
    111,
    111,
    111,
    111,
    111,
    111,
    156,
    234,
    32,
    5,
    135,
    0,
    76,
    46,
    16,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    207,
    6,
    109,
    68,
    138,
    175,
    167,
    147,
    19,
    75,
    209,
    48,
    195,
    231,
    167,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    111,
    7,
    61,
    130,
    230,
    182,
    154,
    143,
    204,
    65,
    56,
    201,
    21,
    8,
    146,
    211,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    105,
    114,
    18,
    34,
    69,
    44,
    154,
    132,
    35,
    55,
    37,
    168,
    103,
    87,
    240,
    235,
    135,
    10,
    227,
    249,
    195,
    168,
    81,
    90,
    219,
    247,
    235,
    229,
    173,
    7,
    219,
    79,
    143,
    137,
    168,
    34,
    192,
    140,
    241,
    24,
    202,
    235,
    244,
    38,
    249,
    223,
    44,
    108,
    204,
    178,
    141,
    154,
    145,
    30,
    19,
    234,
    197,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    92,
    214,
    115,
    219,
    239,
    188,
    93,
    25,
    238,
    133,
    93,
    62,
    225,
    10,
    191,
    202,
    117,
    191,
    34,
    62,
    128,
    178,
    171,
    102,
    177,
    54,
    187,
    202,
    166,
    85,
    43,
    41,
    70,
    150,
    13,
    45,
    227,
    148,
    207,
    68,
    7,
    65,
    215,
    194,
    138,
    34,
    255,
    12,
    5,
    7,
    191,
    49,
    203,
    140,
    132,
    220,
    119,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    45,
    33,
    153,
    169,
    198,
    114,
    98,
    255,
    193,
    161,
    17,
    169,
    137,
    232,
    2,
    182,
    52,
    234,
    66,
    111,
    181,
    64,
    124,
    193,
    92,
    25,
    236,
    57,
    252,
    116,
    230,
    13,
    168,
    56,
    191,
    74,
    203,
    92,
    71,
    32,
    182,
    149,
    179,
    3,
    109,
    115,
    230,
    161,
    183,
    234,
    230,
    141,
    215,
    111,
    39,
    79,
    211,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120,
    94,
    232,
    120
  ]
        )
        .offset(0)
        .instruction();

    invoke_signed(
        &write_data,
        &[
            ctx.accounts.mint_inscription_account.to_account_info(),
            ctx.accounts.inscription_metadata_account.to_account_info(),
            ctx.accounts.user.to_account_info(),
            ctx.accounts.collection_mint.to_account_info(),
            ctx.accounts.system_program.to_account_info(),
        ],
        signer_seeds
    )?;
    Ok(())

}

